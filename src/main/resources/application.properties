#--------------------- DB Connection (HikariCP Optimized) ------------------
# Base DB config
spring.datasource.url=jdbc:postgresql://${DB_HOSTNAME}:${DB_PORT}/${DB_NAME}
spring.datasource.username=${DB_USER}
spring.datasource.password=${DB_PASSWORD}
# Explicit driver class (fixes "undefined driver" log)
spring.datasource.driver-class-name=org.postgresql.Driver

# ========== HikariCP Connection Pool (Spring Boot Default) ==========
spring.datasource.hikari.connection-test-query=SELECT 1
# 30s timeout for getting connection (avoid hanging)
spring.datasource.hikari.connection-timeout=30000
# 10min idle timeout (clean up stale connections)
spring.datasource.hikari.idle-timeout=600000
# 30min max connection lifetime (prevent broken connections)
spring.datasource.hikari.max-lifetime=1800000
# Adjust based on your DB capacity (critical for concurrency)
spring.datasource.hikari.maximum-pool-size=20
# Keep 5 idle connections ready (reduce connection creation overhead)
spring.datasource.hikari.minimum-idle=5
# 60s leak detection (find hanging connections)
spring.datasource.hikari.leak-detection-threshold=60000
# Disable autocommit (required for Hibernate transaction management)
spring.datasource.hikari.auto-commit=false

#--------------------- Fix Hibernate 6.x Isolation/Driver Logs ------------------
# Explicit REPEATABLE_READ isolation (fixes "undefined isolation level" log)
spring.jpa.properties.hibernate.connection.isolation=REPEATABLE_READ

#--------------------JPA-ORM Properties (Optimized for Concurrency)-----------------
spring.jpa.show-sql=true
spring.jpa.hibernate.ddl-auto=update
spring.jpa.properties.hibernate.format_sql=true
# Batch inserts/updates (reduce DB round-trips)
spring.jpa.properties.hibernate.jdbc.batch_size=20
# Order inserts by table (reduce lock waits)
spring.jpa.properties.hibernate.order_inserts=true
# Order updates by table (critical for deadlock prevention)
spring.jpa.properties.hibernate.order_updates=true
# Avoid auto-commit overhead
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=true
# 5s transaction timeout (force fail fast on hanging transactions)
spring.transaction.default-timeout=5

#--------------------JACKSON Properties-----------------
spring.jackson.mapper.accept-case-insensitive-enums=true

#--------------------- MinIO Configuration ------------------
minio.endpoint=${MINIO_ENDPOINT}
minio.access-key=${MINIO_ACCESS_KEY}
minio.secret-key=${MINIO_SECRET_KEY}
minio.public-url=${MINIO_PUBLIC_URL}

# ========== Spring Retry Global Configuration ==========
# Default max retries (overridden by @Retryable(maxAttempts = X))
spring.retry.max-attempts=5
# Default initial delay (ms) for retries
spring.retry.backoff.initial-delay=200
# Exponential backoff (200ms → 300ms → 450ms...)
spring.retry.backoff.multiplier=1.5
# Max delay (2s) to avoid long waits
spring.retry.backoff.max-delay=2000
# Default retry triggers
spring.retry.retry-on=org.springframework.dao.CannotAcquireLockException,org.postgresql.util.PSQLException

#--------------------- JWT Configuration ------------------
# Secret key for signing JWT tokens (min 32 chars for HS256)
jwt.secret=${JWT_SECRET}
# Token expiry in milliseconds (default: 24 hours)
jwt.expiry-ms=${JWT_EXPIRY_MS:86400000}